import unittest
from MarketDataCleaning.market_data_checks import find_outliers, replace_missing_values, find_stale_values

nan = float('nan')

test_dict = {'29/12/2017': 7687.77, '28/12/2017': 7622.88, '27/12/2017': 7620.68, '22/12/2017': 7592.66,
             '21/12/2017': 7603.98, '20/12/2017': 7525.22, '19/12/2017': 7544.09, '18/12/2017': 7537.01,
             '15/12/2017': 0.0, '14/12/2017': 7448.12, '13/12/2017': 74963.51, '12/12/2017': 7500.41,
             '11/12/2017': 7453.48, '08/12/2017': 7393.96, '07/12/2017': 7320.75, '06/12/2017': 7348.03,
             '05/12/2017': 7327.5, '04/12/2017': 7338.97, '01/12/2017': 7300.49, '30/11/2017': 7326.67,
             '29/11/2017': 7393.56, '28/11/2017': 7460.65, '27/11/2017': 7383.9, '24/11/2017': 7409.64,
             '23/11/2017': 7417.24, '22/11/2017': 74195.02, '21/11/2017': 7411.34, '20/11/2017': 7389.46,
             '17/11/2017': 7380.68, '16/11/2017': 7386.94, '15/11/2017': 7372.61, '14/11/2017': 7414.42,
             '13/11/2017': 7415.18, '10/11/2017': 7432.99, '09/11/2017': 7484.1, '08/11/2017': 7529.72,
             '07/11/2017': 7513.11, '06/11/2017': 0.0, '03/11/2017': 7560.35, '02/11/2017': 7555.32,
             '01/11/2017': 7487.96, '31/10/2017': 7493.08, '30/10/2017': 7487.81, '27/10/2017': 7505.03,
             '26/10/2017': 7486.5, '25/10/2017': 7447.21, '24/10/2017': 7526.54, '23/10/2017': 75244.45 }

date_value_dict = {'29/12/2017': 7687.77, '28/12/2017': 7622.88, '27/12/2017': 7620.68, '22/12/2017': 7592.66,
                   '21/12/2017': 7603.98, '20/12/2017': 7525.22, '19/12/2017': 7544.09, '18/12/2017': 7537.01,
                   '15/12/2017': -1.0, '14/12/2017': 7448.12, '13/12/2017': 7496.51, '12/12/2017': 7500.41,
                   '11/12/2017': 7453.48, '08/12/2017': 7393.96, '07/12/2017': 7320.75, '06/12/2017': 7348.03,
                   '05/12/2017': 7327.5, '04/12/2017': 7338.97, '01/12/2017': -1.0, '30/11/2017': 7326.67,
                   '29/11/2017': 7393.56, '28/11/2017': 7460.65, '27/11/2017': 7383.9, '24/11/2017': 7409.64,
                   '23/11/2017': 7417.24, '22/11/2017': 7419.02, '21/11/2017': 7411.34, '19/11/2017': 7404.64 }

test_dict_with_missig = {'29/12/2017': 7687.77, '28/12/2017': 7622.88, '27/12/2017': 7620.68, '22/12/2017': 7592.66,
                         '21/12/2017': 7603.98, '20/12/2017': 7525.22, '19/12/2017': 7544.09, '18/12/2017': 7537.01,
                         '15/12/2017': 0.0, '14/12/2017': 7448.12, '13/12/2017': 74963.51, '12/12/2017': 7500.41,
                         '11/12/2017': 7453.48, '08/12/2017': 7393.96, '07/12/2017': 7320.75, '06/12/2017': 7348.03,
                         '05/12/2017': 7327.5, '04/12/2017': 7338.97, '01/12/2017': 7300.49, '30/11/2017': 7326.67,
                         '29/11/2017': 7393.56, '28/11/2017': 7460.65, '27/11/2017': 7383.9, '24/11/2017': 7409.64,
                         '23/11/2017': 7417.24, '22/11/2017': 74195.02, '21/11/2017': 7411.34, '20/11/2017': 7389.46,
                         '17/11/2017': 7380.68, '16/11/2017': 7386.94, '15/11/2017': 7372.61, '14/11/2017': 7414.42,
                         '13/11/2017': 7415.18, '10/11/2017': 7432.99, '09/11/2017': 7484.1, '08/11/2017': 7529.72,
                         '07/11/2017': 7513.11, '06/11/2017': 0.0, '03/11/2017': 7560.35, '02/11/2017': 7555.32,
                         '01/11/2017': 7487.96, '31/10/2017': 7493.08, '30/10/2017': 7487.81, '27/10/2017': 7505.03,
                         '26/10/2017': 7486.5, '25/10/2017': 7447.21, '24/10/2017': 7526.54, '23/10/2017': 75244.45 }

test_stale_values = {'29/12/2017': 7687.77, '28/12/2017': 7622.88, '27/12/2017': 7620.68, '22/12/2017': 7592.66,
                     '21/12/2017': 7603.98, '20/12/2017': 7525.22, '19/12/2017': 7544.09, '18/12/2017': 7537.01,
                     '15/12/2017': 7532.78, '14/12/2017': 7532.78, '13/12/2017': 7532.78, '12/12/2017': 7532.78,
                     '11/12/2017': 7532.78, '08/12/2017': 7532.78, '07/12/2017': 7532.78, '06/12/2017': 7532.78,
                     '05/12/2017': 7327.5, '04/12/2017': 7338.97, '01/12/2017': 7300.49, '30/11/2017': 7326.67,
                     '29/11/2017': 7393.56, '28/11/2017': 7460.65, '27/11/2017': 7383.9, '24/11/2017': 7409.64,
                     '23/11/2017': 7417.24, '22/11/2017': 7419.02, '21/11/2017': 7411.34, '20/11/2017': 7389.46,
                     '17/11/2017': 7380.68, '16/11/2017': 7386.94, '15/11/2017': 7372.61, '14/11/2017': 7414.42,
                     '13/11/2017': 7415.18, '10/11/2017': 7432.99, '09/11/2017': 7484.1, '08/11/2017': 7529.72,
                     '07/11/2017': 7513.11, '06/11/2017': 7562.28, '03/11/2017': 7560.35, '02/11/2017': 7555.32,
                     '01/11/2017': 7487.96, '31/10/2017': 7493.08, '30/10/2017': 7487.81, '27/10/2017': 7505.03,
                     '26/10/2017': 7486.5, '25/10/2017': 7447.21, '24/10/2017': 7526.54, '23/10/2017': 7524.45,
                     '20/10/2017': 7523.23, '19/10/2017': 7523.04, '18/10/2017': 7542.87, '17/10/2017': 7516.17,
                     '16/10/2017': 7526.97, '13/10/2017': 7535.44, '12/10/2017': 7556.24, '11/10/2017': 7533.81,
                     '10/10/2017': 7538.27, '09/10/2017': 7507.89, '06/10/2017': 7522.87, '05/10/2017': 7507.99,
                     '04/10/2017': 7467.58, '03/10/2017': 7468.11, '02/10/2017': 7438.84, '29/09/2017': 7372.76,
                     '28/09/2017': 7322.82, '27/09/2017': 7313.51, '26/09/2017': 7285.74, '25/09/2017': 7301.29,
                     '22/09/2017': 7310.64, '21/09/2017': 7263.9, '20/09/2017': 7271.95, '19/09/2017': 7275.25,
                     '18/09/2017': 7253.28, '15/09/2017': 7215.47 }

class TestCheckFilesData(unittest.TestCase):

    def test_find_outliers(self):

        outliers = find_outliers(test_dict, -0.6, 2.0)
        expected = 5
        self.assertEqual(len(outliers), expected)

    def test_replace_missing_values(self):
        amended = replace_missing_values(date_value_dict, test_dict_with_missig)
        result = [x for x in amended.values() if x < 0]
        self.assertEqual(len(result), 0)

    def test_find_stale_values(self):
        stales = find_stale_values(test_stale_values)
        self.assertEqual(len(stales), 8)

if __name__ == '__main__':
    unittest.main()